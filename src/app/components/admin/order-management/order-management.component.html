<div class="order-management-container">
  <div class="container">
    <div class="page-header">
      <h1>Order Management</h1>
      <button (click)="loadOrders()" class="btn btn-secondary">
        <span class="btn-icon">üîÑ</span>
        Refresh Orders
      </button>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="filter-group">
        <label class="filter-label">Filter by Status:</label>
        <div class="status-filters">
          <button
            *ngFor="let status of statusOptions"
            (click)="onStatusChange(status)"
            class="status-filter-btn"
            [class.active]="selectedStatus === status"
          >
            {{ status === 'All' ? 'All Orders' : status }}
          </button>
        </div>
      </div>

      <div class="filter-group">
        <label for="dateFilter" class="filter-label">Filter by Date:</label>
        <input
          type="date"
          id="dateFilter"
          (change)="onDateChange($event)"
          class="date-filter"
        >
      </div>
    </div>

    <!-- Success/Error Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <div *ngIf="error" class="alert alert-error">
      {{ error }}
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner-large"></div>
      <p>Loading orders...</p>
    </div>

    <!-- Orders List -->
    <div *ngIf="!loading" class="orders-section">
      <div class="orders-header">
        <h2>Orders ({{ filteredOrders.length }})</h2>
      </div>

      <div class="orders-list" *ngIf="filteredOrders.length > 0">
        <div class="order-card" *ngFor="let order of filteredOrders">
          <div class="order-header">
            <div class="order-info">
              <h3>Order #{{ order.id }}</h3>
              <div class="customer-info">
                <span class="customer-name">{{ order.userName }}</span>
                <span class="customer-email">{{ order.userEmail }}</span>
              </div>
            </div>
            <div class="order-status">
              <span class="status-badge" [class]="getStatusClass(order.status)">
                {{ order.status }}
              </span>
            </div>
          </div>

          <div class="order-details">
            <div class="order-summary">
              <div class="summary-item">
                <strong>Items:</strong>
                <span>{{ getTotalItemCount(order) }} items - {{ getOrderSummary(order) }}</span>
              </div>
              <div class="summary-item">
                <strong>Total:</strong>
                <span class="order-total">{{ formatCurrency(order.totalAmount) }}</span>
              </div>
              <div class="summary-item">
                <strong>Order Time:</strong>
                <span>{{ formatDate(order.orderDate) }}</span>
              </div>
              <div class="summary-item" *ngIf="order.status === 'PREPARING' || order.status === 'READY'">
                <strong>Est. Ready:</strong>
                <span>{{ getEstimatedTime(order) }}</span>
              </div>
            </div>

            <div class="order-items-list">
              <h4>Order Items:</h4>
              <div class="items-grid">
                <div class="item-row" *ngFor="let item of order.items">
                  <span class="item-name">{{ item.menuItemName }}</span>
                  <span class="item-quantity">√ó{{ item.quantity }}</span>
                  <span class="item-price">{{ formatCurrency(item.price * item.quantity) }}</span>
                  <span class="item-instructions" *ngIf="item.specialInstructions">
                    Note: {{ item.specialInstructions }}
                  </span>
                </div>
              </div>
            </div>

            <div class="special-instructions" *ngIf="order.specialInstructions">
              <strong>Special Instructions:</strong>
              <p>{{ order.specialInstructions }}</p>
            </div>
          </div>

          <div class="order-actions">
            <button
              *ngIf="canAdvanceStatus(order.status)"
              (click)="updateOrderStatus(order, getNextStatus(order.status)!)"
              class="btn btn-primary btn-sm"
            >
              <span class="action-icon">‚ñ∂Ô∏è</span>
              {{ getNextStatus(order.status) }}
            </button>

            <button
              *ngIf="canCancelOrder(order.status)"
              (click)="cancelOrder(order)"
              class="btn btn-danger btn-sm"
            >
              <span class="action-icon">‚ùå</span>
              Cancel Order
            </button>

            <div class="status-actions" *ngIf="order.status !== 'DELIVERED' && order.status !== 'CANCELLED'">
              <select
                (change)="updateOrderStatus(order, $any($event.target).value)"
                class="status-select"
                [value]="order.status"
              >
                <option value="PENDING">Pending</option>
                <option value="CONFIRMED">Confirmed</option>
                <option value="PREPARING">Preparing</option>
                <option value="READY">Ready</option>
                <option value="DELIVERED">Delivered</option>
                <option value="CANCELLED">Cancelled</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredOrders.length === 0" class="empty-state">
        <div class="empty-icon">üìã</div>
        <h3>No Orders Found</h3>
        <p *ngIf="selectedStatus !== 'All' || selectedDate">
          No orders match your current filters. Try adjusting your search criteria.
        </p>
        <p *ngIf="selectedStatus === 'All' && !selectedDate">
          No orders have been placed yet. Orders will appear here once customers start ordering.
        </p>
        <button (click)="selectedStatus = 'All'; selectedDate = ''; filterOrders()" class="btn btn-secondary">
          Clear Filters
        </button>
      </div>
    </div>
  </div>
</div>